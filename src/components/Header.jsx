import React, { useRef, useEffect, useContext, useState } from "react"
import { Link, navigate } from "gatsby"
import { useLocation } from "@reach/router"

import {
  connectHits,
  connectStateResults,
  Index,
  SearchBox,
  Highlight,
} from "react-instantsearch-dom"
import HeaderMobile from "./widgets/HeaderMobile"
import SearchContext from "../context/searchContext"
import CustomHighlight from "./search/highlight"

export default function Header() {
  const { redirectStatus, setRedirectStatus } = useContext(SearchContext)
  const ref = useRef(null)

  useEffect(() => {
    const handleClickOutside = event => {
      if (ref.current && !ref.current.contains(event.target)) {
        setRedirectStatus(true)
      }
    }
    document.addEventListener("mousedown", handleClickOutside)
    return () => {
      document.removeEventListener("mousedown", handleClickOutside)
    }
  }, [ref, setRedirectStatus])

  const IndexResults = connectStateResults(
    ({ searchState, searchResults, children }) => {
      if (redirectStatus) {
        searchState.query = ""
      }
      return searchResults && searchResults.nbHits !== 0 && searchState.query
        ? children
        : null
    }
  )
  const location = useLocation()

  return (
    <header className="z-50 sticky top-0 w-full smobile:px-5 px-8 md:px-0">
      <div className="navbar max-width justify-between gap-8">
        <div className="px-2 lmobile:hidden md:pl-0 md:ml-0 w-80">
          <Link to="/">
            {/* logo svg */}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="281"
              height="28"
              fill="none"
            >
              <path
                fill="#FCFCFC"
                d="M4.472 8.154 2.577 6.49l1.986-1.951 1.693 1.86c.343-.26.703-.497 1.078-.71L6.232 3.442l2.594-1.057.84 2.356c.418-.11.844-.193 1.274-.248L10.798 2h2.81l-.155 2.492c.43.055.856.138 1.275.248l.839-2.356 2.595 1.057-1.075 2.248c.374.212.734.45 1.078.71l1.692-1.861 1.987 1.951-1.896 1.665c.265.337.507.691.724 1.06l2.289-1.081 1.075 2.55-2.407.825c.111.41.195.828.251 1.25l2.537-.139v2.762l-2.537-.14c-.055.423-.14.84-.251 1.251l2.398.825-1.075 2.55-2.29-1.082c-.217.37-.458.724-.723 1.06l1.895 1.666-1.986 1.951-1.692-1.86a9.77 9.77 0 0 1-1.078.71l1.102 2.247-2.595 1.057-.839-2.356c-.419.11-.845.193-1.275.248L13.614 26h-2.81l.142-2.492a9.971 9.971 0 0 1-1.275-.248l-.838 2.356-2.595-1.057L7.34 22.31a9.761 9.761 0 0 1-1.078-.71l-1.693 1.861-1.986-1.951 1.895-1.665a9.568 9.568 0 0 1-.723-1.06l-2.29 1.081-1.074-2.55 2.398-.825a9.367 9.367 0 0 1-.252-1.25L0 15.38v-2.765l2.537.14c.056-.423.14-.84.252-1.252L.39 10.68l1.075-2.55 2.298 1.084c.212-.368.449-.722.708-1.06Zm1.817 5.843a5.893 5.893 0 0 0 .953 3.304 5.928 5.928 0 0 0 9.114.993 5.9 5.9 0 0 0 1.324-6.444 5.906 5.906 0 0 0-2.178-2.664 5.926 5.926 0 0 0-3.296-1.002A5.883 5.883 0 0 0 8.04 9.868a5.858 5.858 0 0 0-1.752 4.129Zm134.983-6.224 9.387 9.272V8.254H152v11.86l-9.387-9.256v8.746h-1.341V7.774Zm-16.39 6.152c0 2.558 2.201 4.694 4.932 4.694 2.731 0 4.93-2.136 4.93-4.694 0-2.56-2.171-4.698-4.93-4.698-2.758 0-4.932 2.127-4.932 4.697Zm11.203.015c0 3.265-2.84 5.855-6.271 5.855-3.43 0-6.271-2.59-6.271-5.855 0-3.266 2.841-5.886 6.271-5.886 3.431 0 6.271 2.638 6.271 5.889v-.003Zm-18.149-3.475c-.479-.782-1.054-1.235-2.075-1.235-1.068 0-1.995.722-1.995 1.76 0 .98 1.069 1.43 1.883 1.777l.8.333c1.565.646 2.888 1.383 2.888 3.19 0 1.988-1.692 3.508-3.781 3.508-1.932 0-3.368-1.176-3.749-2.937l1.308-.347a2.417 2.417 0 0 0 2.422 2.114c1.293 0 2.474-.933 2.474-2.211 0-1.278-1.102-1.777-2.219-2.257l-.733-.302c-1.405-.604-2.616-1.278-2.616-2.903 0-1.762 1.58-2.892 3.367-2.892a3.49 3.49 0 0 1 3.113 1.762l-1.087.64Zm-15.567 3.043h.409c1.514 0 3.046-.272 3.046-2.034 0-1.867-1.454-2.048-3.065-2.048h-.399l.009 4.082Zm0 6.096h-1.341V8.254h1.75c2.283 0 4.402.57 4.402 3.13 0 1.746-1.165 2.979-3.028 3.13l3.834 5.09h-1.644l-3.634-4.982h-.336l-.003 4.982ZM89.588 8.254h6.225v1.172h-4.887v3.375h4.754v1.175h-4.754v4.456h4.887v1.175h-6.225V8.254Zm-9.69 5.208h.909c1.484 0 2.743-.423 2.743-2.048 0-1.852-1.58-1.988-3.143-1.988h-.493l-.016 4.036Zm0 6.142h-1.344V8.254h1.98c1.036 0 2.12.03 2.983.604a3.075 3.075 0 0 1 1.356 2.59 3.106 3.106 0 0 1-1.147 2.437c-.815.632-1.85.752-2.855.752h-.975l.002 4.967Zm-11.033-9.423v2.499h3.585v1.927h-3.585v3.073h3.724v1.927h-5.977V8.254h5.977v1.927h-3.724Zm-11.616 4.834 2.753-6.75h2.422l-5.13 11.97-5.083-11.981h2.422l2.616 6.761Zm-9.217 4.592H45.78V8.254h2.252v11.353Zm-9.75-1.927h3.189v1.927h-5.45V8.254h2.261v9.426Z"
              />
              <path stroke="#C6C9D2" d="M168.5 2v24" />
              <path
                fill="#fff"
                d="M185.242 20V7.4h2.178v5.13h.306l4.392-5.13h2.79l-5.49 6.21 5.67 6.39h-2.862l-4.5-5.238h-.306V20h-2.178Zm11.269 0v-8.892h2.034v1.242h.306c.156-.336.438-.654.846-.954.408-.3 1.026-.45 1.854-.45.684 0 1.29.156 1.818.468.528.312.936.744 1.224 1.296.3.552.45 1.206.45 1.962V20h-2.07v-5.166c0-.72-.18-1.254-.54-1.602-.348-.36-.846-.54-1.494-.54-.732 0-1.308.246-1.728.738-.42.48-.63 1.17-.63 2.07V20h-2.07Zm15.286.252c-.888 0-1.686-.18-2.394-.54a4.242 4.242 0 0 1-1.656-1.566c-.396-.684-.594-1.5-.594-2.448v-.288c0-.948.198-1.764.594-2.448a4.077 4.077 0 0 1 1.656-1.566c.708-.36 1.506-.54 2.394-.54.888 0 1.68.18 2.376.54a3.96 3.96 0 0 1 1.638 1.566c.408.684.612 1.5.612 2.448v.288c0 .948-.204 1.764-.612 2.448a4.115 4.115 0 0 1-1.638 1.566c-.696.36-1.488.54-2.376.54Zm0-1.836c.756 0 1.374-.24 1.854-.72.48-.492.72-1.176.72-2.052v-.18c0-.876-.24-1.554-.72-2.034-.48-.492-1.098-.738-1.854-.738s-1.374.246-1.854.738c-.48.48-.72 1.158-.72 2.034v.18c0 .876.24 1.56.72 2.052.48.48 1.098.72 1.854.72ZM219.4 20l-1.386-8.892h2.052l.954 7.506h.306l1.35-7.506h3.312l1.35 7.506h.306l.954-7.506h2.052L229.264 20h-3.438l-1.332-7.506h-.306L222.838 20H219.4Zm13.34 0V7.4h2.07V20h-2.07Zm8.761.252c-.888 0-1.674-.186-2.358-.558a4.147 4.147 0 0 1-1.584-1.602c-.372-.696-.558-1.506-.558-2.43v-.216c0-.936.186-1.746.558-2.43a3.903 3.903 0 0 1 1.566-1.584c.672-.384 1.446-.576 2.322-.576.864 0 1.62.192 2.268.576.648.372 1.152.9 1.512 1.584.36.684.54 1.482.54 2.394v.738h-6.678c.024.696.27 1.254.738 1.674.468.42 1.044.63 1.728.63.672 0 1.17-.144 1.494-.432.324-.3.57-.636.738-1.008l1.71.882a5.454 5.454 0 0 1-.738 1.044c-.312.36-.732.672-1.26.936-.528.252-1.194.378-1.998.378Zm-2.394-5.67h4.554c-.048-.588-.276-1.056-.684-1.404-.396-.348-.912-.522-1.548-.522-.66 0-1.188.174-1.584.522-.396.348-.642.816-.738 1.404Zm12.421 5.67c-.72 0-1.392-.174-2.016-.522-.624-.36-1.122-.882-1.494-1.566-.372-.684-.558-1.506-.558-2.466v-.288c0-.96.186-1.782.558-2.466.372-.684.864-1.2 1.476-1.548a4 4 0 0 1 2.034-.54c.552 0 1.02.066 1.404.198.384.132.69.3.918.504.24.204.426.426.558.666h.306V7.4h2.052V20h-2.016v-1.17h-.306c-.216.36-.546.69-.99.99-.444.288-1.086.432-1.926.432Zm.612-1.8c.744 0 1.362-.24 1.854-.72.492-.492.738-1.188.738-2.088v-.18c0-.912-.246-1.608-.738-2.088-.48-.48-1.098-.72-1.854-.72-.744 0-1.368.24-1.872.72-.492.48-.738 1.176-.738 2.088v.18c0 .9.246 1.596.738 2.088.504.48 1.128.72 1.872.72Zm6.816-2.862v-.27c0-.936.186-1.734.558-2.394.372-.672.87-1.182 1.494-1.53a4.034 4.034 0 0 1 2.052-.54c.84 0 1.476.15 1.908.45.444.3.768.624.972.972h.306v-1.17h2.016v10.584c0 .588-.168 1.05-.504 1.386-.336.348-.792.522-1.368.522h-5.976v-1.8h5.274c.348 0 .522-.18.522-.54v-2.574h-.306a3.524 3.524 0 0 1-.54.63 2.916 2.916 0 0 1-.9.522c-.372.144-.84.216-1.404.216a4.142 4.142 0 0 1-2.052-.522 3.982 3.982 0 0 1-1.494-1.53c-.372-.672-.558-1.476-.558-2.412Zm4.68 2.646c.744 0 1.362-.234 1.854-.702.492-.48.738-1.146.738-1.998v-.18c0-.864-.246-1.53-.738-1.998-.48-.468-1.098-.702-1.854-.702-.744 0-1.368.234-1.872.702-.492.468-.738 1.134-.738 1.998v.18c0 .852.246 1.518.738 1.998.504.468 1.128.702 1.872.702Zm11.316 2.016c-.888 0-1.674-.186-2.358-.558a4.147 4.147 0 0 1-1.584-1.602c-.372-.696-.558-1.506-.558-2.43v-.216c0-.936.186-1.746.558-2.43a3.903 3.903 0 0 1 1.566-1.584c.672-.384 1.446-.576 2.322-.576.864 0 1.62.192 2.268.576.648.372 1.152.9 1.512 1.584.36.684.54 1.482.54 2.394v.738h-6.678c.024.696.27 1.254.738 1.674.468.42 1.044.63 1.728.63.672 0 1.17-.144 1.494-.432.324-.3.57-.636.738-1.008l1.71.882a5.454 5.454 0 0 1-.738 1.044c-.312.36-.732.672-1.26.936-.528.252-1.194.378-1.998.378Zm-2.394-5.67h4.554c-.048-.588-.276-1.056-.684-1.404-.396-.348-.912-.522-1.548-.522-.66 0-1.188.174-1.584.522-.396.348-.642.816-.738 1.404Z"
              />
            </svg>
          </Link>
        </div>
        <div className="navbar-start hidden lmobile:visible lmobile:flex w-auto">
          {/* logo mobile */}
          <Link to="/">
            <svg
              width="161"
              height="32"
              viewBox="0 0 161 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M8.24962 15.9997C8.24962 20.2805 11.7194 23.75 15.9996 23.75C20.2797 23.75 23.7495 20.2805 23.7495 15.9997C23.7495 11.7204 20.2797 8.25055 15.9996 8.25055C11.7194 8.25055 8.24962 11.7204 8.24962 15.9997ZM5.86653 8.20662L3.38442 5.98837L5.98803 3.38518L8.20637 5.86728C8.66051 5.51703 9.13257 5.20117 9.61943 4.92085L8.17706 1.9232L11.5774 0.513817L12.6766 3.65567C13.2269 3.50771 13.7844 3.39819 14.3455 3.32536L14.1597 0H17.84L17.6534 3.32536C18.2156 3.39819 18.7728 3.50858 19.3222 3.65567L20.4217 0.513817L23.8232 1.9232L22.3797 4.92085C22.8663 5.20204 23.3392 5.51761 23.7936 5.86815L26.0125 3.38518L28.6147 5.98779L26.1329 8.20662C26.4829 8.66091 26.799 9.13369 27.0793 9.62034L30.077 8.17715L31.4858 11.5782L28.345 12.6778C28.4921 13.2269 28.6019 13.7849 28.6751 14.3458L32 14.16V17.8414L28.6751 17.6547C28.6019 18.2157 28.4921 18.7737 28.3441 19.323L31.4858 20.4232L30.077 23.8237L27.0793 22.3797C26.7982 22.8669 26.4823 23.3391 26.1326 23.794L28.6147 26.0131L26.0125 28.6154L23.7936 26.1327C23.3392 26.483 22.8663 26.7988 22.3797 27.08L23.8232 30.0774L20.4217 31.4862L19.3222 28.3452C18.7728 28.4923 18.2156 28.6024 17.6534 28.6752L17.84 32H14.1597L14.3455 28.6752C13.7844 28.6024 13.2269 28.4923 12.6766 28.3452L11.5774 31.4862L8.17649 30.0774L9.61943 27.08C9.13257 26.7988 8.66051 26.483 8.20637 26.1327L5.98803 28.6154L3.38442 26.0131L5.86653 23.7934C5.51682 23.3391 5.20069 22.8669 4.91984 22.3797L1.92212 23.8228L0.513894 20.4218L3.65474 19.323C3.50706 18.7737 3.39722 18.2157 3.32466 17.6547L0 17.8414V14.16L3.32466 14.3458C3.39722 13.7849 3.50706 13.2269 3.65474 12.6778L0.513894 11.5782L1.92212 8.17715L4.91984 9.62034C5.20069 9.13369 5.51682 8.66091 5.86653 8.20662Z"
                fill="#FCFCFC"
              />
              <line x1="48.5" y1="4" x2="48.5" y2="28" stroke="#C6C9D2" />
              <path
                d="M65.242 22V9.4H67.42V14.53H67.726L72.118 9.4H74.908L69.418 15.61L75.088 22H72.226L67.726 16.762H67.42V22H65.242ZM76.5113 22V13.108H78.5453V14.35H78.8513C79.0073 14.014 79.2893 13.696 79.6973 13.396C80.1053 13.096 80.7233 12.946 81.5513 12.946C82.2353 12.946 82.8413 13.102 83.3693 13.414C83.8973 13.726 84.3053 14.158 84.5933 14.71C84.8933 15.262 85.0433 15.916 85.0433 16.672V22H82.9733V16.834C82.9733 16.114 82.7933 15.58 82.4333 15.232C82.0853 14.872 81.5873 14.692 80.9393 14.692C80.2073 14.692 79.6313 14.938 79.2113 15.43C78.7913 15.91 78.5813 16.6 78.5813 17.5V22H76.5113ZM91.7975 22.252C90.9095 22.252 90.1115 22.072 89.4035 21.712C88.7075 21.34 88.1555 20.818 87.7475 20.146C87.3515 19.462 87.1535 18.646 87.1535 17.698V17.41C87.1535 16.462 87.3515 15.646 87.7475 14.962C88.1555 14.278 88.7075 13.756 89.4035 13.396C90.1115 13.036 90.9095 12.856 91.7975 12.856C92.6855 12.856 93.4775 13.036 94.1735 13.396C94.8695 13.756 95.4155 14.278 95.8115 14.962C96.2195 15.646 96.4235 16.462 96.4235 17.41V17.698C96.4235 18.646 96.2195 19.462 95.8115 20.146C95.4155 20.818 94.8695 21.34 94.1735 21.712C93.4775 22.072 92.6855 22.252 91.7975 22.252ZM91.7975 20.416C92.5535 20.416 93.1715 20.176 93.6515 19.696C94.1315 19.204 94.3715 18.52 94.3715 17.644V17.464C94.3715 16.588 94.1315 15.91 93.6515 15.43C93.1715 14.938 92.5535 14.692 91.7975 14.692C91.0415 14.692 90.4235 14.938 89.9435 15.43C89.4635 15.91 89.2235 16.588 89.2235 17.464V17.644C89.2235 18.52 89.4635 19.204 89.9435 19.696C90.4235 20.176 91.0415 20.416 91.7975 20.416ZM99.4002 22L98.0142 13.108H100.066L101.02 20.614H101.326L102.676 13.108H105.988L107.338 20.614H107.644L108.598 13.108H110.65L109.264 22H105.826L104.494 14.494H104.188L102.838 22H99.4002ZM112.74 22V9.4H114.81V22H112.74ZM121.501 22.252C120.613 22.252 119.827 22.066 119.143 21.694C118.471 21.31 117.943 20.776 117.559 20.092C117.187 19.396 117.001 18.586 117.001 17.662V17.446C117.001 16.51 117.187 15.7 117.559 15.016C117.931 14.332 118.453 13.804 119.125 13.432C119.797 13.048 120.571 12.856 121.447 12.856C122.311 12.856 123.067 13.048 123.715 13.432C124.363 13.804 124.867 14.332 125.227 15.016C125.587 15.7 125.767 16.498 125.767 17.41V18.148H119.089C119.113 18.844 119.359 19.402 119.827 19.822C120.295 20.242 120.871 20.452 121.555 20.452C122.227 20.452 122.725 20.308 123.049 20.02C123.373 19.72 123.619 19.384 123.787 19.012L125.497 19.894C125.329 20.218 125.083 20.566 124.759 20.938C124.447 21.298 124.027 21.61 123.499 21.874C122.971 22.126 122.305 22.252 121.501 22.252ZM119.107 16.582H123.661C123.613 15.994 123.385 15.526 122.977 15.178C122.581 14.83 122.065 14.656 121.429 14.656C120.769 14.656 120.241 14.83 119.845 15.178C119.449 15.526 119.203 15.994 119.107 16.582ZM131.528 22.252C130.808 22.252 130.136 22.078 129.512 21.73C128.888 21.37 128.39 20.848 128.018 20.164C127.646 19.48 127.46 18.658 127.46 17.698V17.41C127.46 16.45 127.646 15.628 128.018 14.944C128.39 14.26 128.882 13.744 129.494 13.396C130.118 13.036 130.796 12.856 131.528 12.856C132.08 12.856 132.548 12.922 132.932 13.054C133.316 13.186 133.622 13.354 133.85 13.558C134.09 13.762 134.276 13.984 134.408 14.224H134.714V9.4H136.766V22H134.75V20.83H134.444C134.228 21.19 133.898 21.52 133.454 21.82C133.01 22.108 132.368 22.252 131.528 22.252ZM132.14 20.452C132.884 20.452 133.502 20.212 133.994 19.732C134.486 19.24 134.732 18.544 134.732 17.644V17.464C134.732 16.552 134.486 15.856 133.994 15.376C133.514 14.896 132.896 14.656 132.14 14.656C131.396 14.656 130.772 14.896 130.268 15.376C129.776 15.856 129.53 16.552 129.53 17.464V17.644C129.53 18.544 129.776 19.24 130.268 19.732C130.772 20.212 131.396 20.452 132.14 20.452ZM138.956 17.59V17.32C138.956 16.384 139.142 15.586 139.514 14.926C139.886 14.254 140.384 13.744 141.008 13.396C141.632 13.036 142.316 12.856 143.06 12.856C143.9 12.856 144.536 13.006 144.968 13.306C145.412 13.606 145.736 13.93 145.94 14.278H146.246V13.108H148.262V23.692C148.262 24.28 148.094 24.742 147.758 25.078C147.422 25.426 146.966 25.6 146.39 25.6H140.414V23.8H145.688C146.036 23.8 146.21 23.62 146.21 23.26V20.686H145.904C145.772 20.89 145.592 21.1 145.364 21.316C145.136 21.52 144.836 21.694 144.464 21.838C144.092 21.982 143.624 22.054 143.06 22.054C142.316 22.054 141.632 21.88 141.008 21.532C140.384 21.172 139.886 20.662 139.514 20.002C139.142 19.33 138.956 18.526 138.956 17.59ZM143.636 20.236C144.38 20.236 144.998 20.002 145.49 19.534C145.982 19.054 146.228 18.388 146.228 17.536V17.356C146.228 16.492 145.982 15.826 145.49 15.358C145.01 14.89 144.392 14.656 143.636 14.656C142.892 14.656 142.268 14.89 141.764 15.358C141.272 15.826 141.026 16.492 141.026 17.356V17.536C141.026 18.388 141.272 19.054 141.764 19.534C142.268 20.002 142.892 20.236 143.636 20.236ZM154.952 22.252C154.064 22.252 153.278 22.066 152.594 21.694C151.922 21.31 151.394 20.776 151.01 20.092C150.638 19.396 150.452 18.586 150.452 17.662V17.446C150.452 16.51 150.638 15.7 151.01 15.016C151.382 14.332 151.904 13.804 152.576 13.432C153.248 13.048 154.022 12.856 154.898 12.856C155.762 12.856 156.518 13.048 157.166 13.432C157.814 13.804 158.318 14.332 158.678 15.016C159.038 15.7 159.218 16.498 159.218 17.41V18.148H152.54C152.564 18.844 152.81 19.402 153.278 19.822C153.746 20.242 154.322 20.452 155.006 20.452C155.678 20.452 156.176 20.308 156.5 20.02C156.824 19.72 157.07 19.384 157.238 19.012L158.948 19.894C158.78 20.218 158.534 20.566 158.21 20.938C157.898 21.298 157.478 21.61 156.95 21.874C156.422 22.126 155.756 22.252 154.952 22.252ZM152.558 16.582H157.112C157.064 15.994 156.836 15.526 156.428 15.178C156.032 14.83 155.516 14.656 154.88 14.656C154.22 14.656 153.692 14.83 153.296 15.178C152.9 15.526 152.654 15.994 152.558 16.582Z"
                fill="white"
              />
            </svg>
          </Link>
        </div>
        <div className="searchcomponent hidden flex-grow navbar-center md:flex">
          <div className="flex items-stretch w-full flex-col relative">
            <SearchBox
              submit={
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M21 19.6L16.5 15C17.5 13.7 18 12.2 18 10.5C18 6.4 14.6 3 10.5 3C6.4 3 3 6.4 3 10.5C3 14.6 6.4 18 10.5 18C12.2 18 13.8 17.4 15 16.5L19.5 21L21 19.6ZM10.5 16C7.5 16 5 13.5 5 10.5C5 7.5 7.5 5 10.5 5C13.5 5 16 7.5 16 10.5C16 13.5 13.5 16 10.5 16Z"
                    fill="var(--search-input-color)"
                  />
                </svg>
              }
              onSubmit={event => {
                event.preventDefault()
                navigate("/search")
              }}
              style={{ borderRadius: `32px`, backgroundColor: "#EEEFF1" }}
              type="text"
              placeholder="SEARCH"
              className="search-input w-full rounded-full"
            />
            {location.pathname !== "/search" && (
              <div ref={ref}>
                <Index indexName="helpcenter">
                  <IndexResults>
                    <div
                      className="right-panel"
                      style={{
                        background: "var(--body-background)",
                        color: "var(--body-text)",
                        borderRadius: "2px",
                        zIndex: 9999,
                        position: "absolute",
                        top: "3rem",
                        width: "100%",
                        maxHeight: "75vh",
                        overflowY: "auto",
                        boxShadow: "0px 2px 8px var(--search-input-background)",
                      }}
                    >
                      <CustomHits onClose={() => setRedirectStatus(true)} />
                    </div>
                  </IndexResults>
                </Index>
              </div>
            )}
          </div>
        </div>
        <div className="gap-8 relative">
          <HeaderMobile />
          <label
            htmlFor="my-drawer-2"
            className="drawer-button md:hidden !text-dark-text"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              className="inline-block w-6 h-6 stroke-current"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </label>
          <a
            href="https://liveengage.liveperson.net/"
            target="_blank"
            rel="noreferrer"
            aria-label="Sign in"
            className="!text-dark-text hover:!text-primary normal-case mobile:hidden px-8"
            style={{ fontSize: "1.125rem", lineHeight: "1.75rem" }}
          >
            Sign in
          </a>
          {/* <a
            target="_blank"
            rel="noreferrer"
            aria-label="register"
            href="https://developers.liveperson.com/register.html"
            className="btn btn-primary btn-primary-hover normal-case rounded-full px-8 mobile:hidden"
          >
            Free trial
          </a> */}
        </div>
      </div>
    </header>
  )
}

const Hit = props => {
  const [hits, setHits] = useState([])
  useEffect(() => {
    if (JSON.stringify(props.hits) !== JSON.stringify(hits)) {
      setHits(props.hits)
      console.log(props.hits, hits)
    }
  }, [props, hits])
  return (
    <>
      {props.hits.map((pP, index) => {
        // console.log(pP.type)
        let higlightedAttributes = Object.keys(pP._highlightResult).filter(
          v =>
            pP._highlightResult[v].matchLevel !== "none" &&
            v !== "title" &&
            v !== "subtitle"
        )
        return (
          <div key={index} className="hit-block">
            <Link
              to={
                pP.type === "release-notes" || pP.type === "whats-new"
                  ? `/${pP.type}/${pP.link}`
                  : `/${pP.link}`
              }
              onClick={props.onClose}
            >
              <div className="hit-name">
                <p className="font-bold text-body-text mb-1" attribute="name">
                  <Highlight attribute="title" hit={pP} />
                </p>
              </div>
              <CustomHighlight
                className="text-footer-text"
                attribute="subtitle"
                hit={pP}
              />
              {higlightedAttributes?.length > 0 &&
                higlightedAttributes.map((v, k) => (
                  <CustomHighlight
                    className="text-footer-text  subtitle-search"
                    attribute={v}
                    key={k}
                    hit={pP}
                  />
                ))}
            </Link>
          </div>
        )
      })}
    </>
  )
}

const CustomHits = connectHits(Hit)
